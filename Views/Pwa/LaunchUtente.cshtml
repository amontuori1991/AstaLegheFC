@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Avvio…</title>
    <meta name="theme-color" content="#2c3e50" />
    <link rel="manifest" href="/pwa/manifest-utente">
    <style>
        html, body {
            height: 100%
        }

        body {
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #2c3e50;
            color: #ecf0f1;
            font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif
        }

        .box {
            max-width: 420px;
            width: 92%
        }

        .fld {
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #34495e;
            background: #1f2a39;
            color: #fff
        }

        .btn {
            padding: 10px 14px;
            border-radius: 8px;
            border: 0;
            background: #3498db;
            color: #fff;
            font-weight: 700;
            cursor: pointer
        }

        .stack {
            display: flex;
            flex-direction: column;
            gap: 10px
        }
    </style>
</head>
<body>
    <div id="app" class="box">Avvio asta…</div>

    <script>
        (function () {
          try {
            const u = new URL(location.href);
            let lega = u.searchParams.get('lega');
            let nick = u.searchParams.get('nick');

            if (!lega || !nick) {
              lega = localStorage.getItem('pwa:lega');
              nick = localStorage.getItem('pwa:nick');
            }

            if (lega && nick) {
              location.replace(`/Utente?lega=${encodeURIComponent(lega)}&nick=${encodeURIComponent(nick)}`);
              return;
            }

            // Fallback: chiedi i dati una volta sola, salvali e vai
            document.getElementById('app').innerHTML = `
              <div class="stack">
                <h2>Completa i dati</h2>
                <input id="lega" class="fld" placeholder="Alias lega" />
                <input id="nick" class="fld" placeholder="Nickname" />
                <button id="go" class="btn">Entra</button>
              </div>`;
            document.getElementById('go').onclick = function () {
              const l = document.getElementById('lega').value.trim();
              const n = document.getElementById('nick').value.trim();
              if (!l || !n) { alert('Inserisci lega e nick'); return; }
              localStorage.setItem('pwa:lega', l);
              localStorage.setItem('pwa:nick', n);
              location.assign(`/Utente?lega=${encodeURIComponent(l)}&nick=${encodeURIComponent(n)}`);
            };
          } catch (e) {
            console.error(e);
            document.getElementById('app').textContent = 'Errore di avvio. Apri dal browser e aggiungi di nuovo alla Home.';
          }
        })();
    </script>
</body>
</html>
